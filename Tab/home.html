<!DOCTYPE html>
<html>
  <head>
    <title>OneDrive Explorer</title>
    <style>
      /* éšè—å¤é€‰æ¡† */
      input[type="checkbox"] {
        display: none;
      }

      /* éšè—æœªé€‰ä¸­çš„å­èŠ‚ç‚¹ */
      input[type="checkbox"] ~ ul {
        display: none;
      }

      /* æ˜¾ç¤ºé€‰ä¸­çš„å­èŠ‚ç‚¹ */
      input[type="checkbox"]:checked ~ ul {
        display: block;
      }

      /* è®¾ç½®æ–‡ä»¶å¤¹å›¾æ ‡ */
      label:before {
        content: "ğŸ“";
        margin-right: 5px;
      }
    </style>
  </head>
  <body>
    <h2>OneDrive Explorer</h2>
    <div id="tree"></div>
    <script>
      // æ›¿æ¢ä¸ºæ‚¨çš„å®¢æˆ·ç«¯ ID
      const CLIENT_ID = '0a2991a3-1674-4334-8561-671cc7349960';
      // æ›¿æ¢ä¸ºæ‚¨çš„å®¢æˆ·ç«¯å¯†é’¥
      const CLIENT_SECRET = 'uw67Q~TCMqdJyH35hlcHHclv~mhNOGx.jfPFm';
      // æ›¿æ¢ä¸ºæ‚¨çš„åˆ·æ–°ä»¤ç‰Œ
      const REFRESH_TOKEN = '0.AXEA2vnFdXOjf0ixjUt0Bezcg6ORKQp0FjRDhWFnHMc0mWBxABY.AgABAAEAAAD--DLA3VO7QrddgJg7WevrAgDs_wUA9P97RLfwX_Q4iwef60czGVYtBngib4rQ52GLlT9gffHzVNEy2FOfQAtfNla9C9pmBAv57EGBywSohh8_1aBUFoft-lKdIpZDZqioryMQKKqrhck9UIf0pRkkkt7e7aWH8PaWXtWS-eghiqEMRxz36hO0C7ZMpX28feZ6ZBzUnvQuBctAe3rfODf2nnMtUTYHADLsJ9LT7kjVcbZsm8JdRetF3h2_MmkIw4ya00Qyd6WKLfqBDOBNawUZ22YWLv6iKr0HX8qb6YhLUrxsOq0rkliVM26bNGxQKN6Can1IpWjzQAtx3Hs-IEPUbYliOJf2AjBJb5jw3uMT0yA1PTcppWIMblgO4mnVnuISrzpVvmINPZr5D8bkA0kkiunEI9khOdCKg-n8BRPHtto1W_phzMtGYdwf9HZVO7I3HWlfzhYf58WCjEl8m2oMbsLsNs7eCnS48rQgKw1hisgWg25lF6WUGg07raF0w2KIIvoW-zz1n3vm8q94YvEe5xAc-XmOrwRgoFkvplJxsVkjRhpmvcGwKQHDh2L_DZyasUM3-ug1W-HLClOl0vNmESc8EpIKz9je9ACm85MK1UU8rv1Nr5OfTq286PxjfqRTwAzXTWNV5jGRqWsQLVxjkxTojAJYFksuF2s-0tNzJ9jt8cymHHy_pVCZykKWNYhacqZODaILm3rIJEZJfHONG642xb5KNyIwjAGKSH4blL71K3MHvqXXCl7Hr21ZOOvzz0Q3QMuHClv8t1ENLEZ2vNW-ZPX8BPVAF0Q';

      // è·å–è®¿é—®ä»¤ç‰Œ
      async function getAccessToken() {
        const url = 'https://login.microsoftonline.com/common/oauth2/v2.0/token';
        const data = {
          client_id: CLIENT_ID,
          client_secret: CLIENT_SECRET,
          grant_type: 'refresh_token',
          refresh_token: REFRESH_TOKEN,
          scope: 'https://graph.microsoft.com/.default',
        };
        const response = await fetch(url, {
          method: 'POST',
          body: new URLSearchParams(data),
          headers: {
            'Content-Type': 'application/x-www-form-urlencoded'
          }
        });
        const responseJson = await response.json();
        const accessToken = responseJson.access_token;
        return accessToken;
      }

      // è·å–æ–‡ä»¶å¤¹å†…å®¹
      async function getFolderContent(accessToken, folderId) {
        let url;
        if (folderId) {
          url = `https://graph.microsoft.com/v1.0/me/drive/items/${folderId}/children`;
        } else {
          url = 'https://graph.microsoft.com/v1.0/me/drive/root/children';
        }
        const response = await fetch(url, {
          headers: {Authorization: 'Bearer ' + accessToken}
        });
        const responseJson = await response.json();
        const items = responseJson.value;
        return items;
      }

      // åˆ›å»ºç›®å½•æ ‘èŠ‚ç‚¹
      async function createTreeNode(accessToken, folderId) {
        // è·å–æ–‡ä»¶å¤¹å†…å®¹
        const items = await getFolderContent(accessToken, folderId);
        // åˆ›å»ºæ— åºåˆ—è¡¨å…ƒç´ 
        const ulElement = document.createElement('ul');
        for (const item of items) {
          // åˆ›å»ºåˆ—è¡¨é¡¹å…ƒç´ 
          const liElement = document.createElement('li');
          if (item.folder) {
            // å¦‚æœæ˜¯æ–‡ä»¶å¤¹ï¼Œåˆ™åˆ›å»ºå¤é€‰æ¡†å’Œæ ‡ç­¾å…ƒç´ 
            const checkboxElement = document.createElement('input');
            checkboxElement.type = 'checkbox';
            liElement.appendChild(checkboxElement);
            const labelElement = document.createElement('label');
            labelElement.textContent = item.name;
            liElement.appendChild(labelElement);
            // é€’å½’åˆ›å»ºå­èŠ‚ç‚¹
            const childUlElement = await createTreeNode(accessToken, item.id);
            liElement.appendChild(childUlElement);
          } else {
            // å¦‚æœæ˜¯æ–‡ä»¶ï¼Œåˆ™åªæ˜¾ç¤ºåç§°
            liElement.textContent = item.name;
          }
          ulElement.appendChild(liElement);
        }
        return ulElement;
      }

      async function main() {
        // è·å–è®¿é—®ä»¤ç‰Œ
        const accessToken = await getAccessToken();
        // åˆ›å»ºç›®å½•æ ‘èŠ‚ç‚¹
        const treeElement = await createTreeNode(accessToken);
        // å°†ç›®å½•æ ‘èŠ‚ç‚¹æ·»åŠ åˆ°é¡µé¢ä¸­
        document.getElementById('tree').appendChild(treeElement);
      }

      main();
    </script>
  </body>
</html>
